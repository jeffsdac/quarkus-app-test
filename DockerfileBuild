FROM quay.io/quarkus/ubi-quarkus-mandrel-builder-image:22.3-java17 AS build

WORKDIR /project

COPY mvnw .
COPY .mvn .mvn
COPY pom.xml .

RUN ./mvnw dependency:go-offline

COPY src src

RUN ./mvnw package -Pnative

FROM registry.access.redhat.com/ubi8/ubi-minimal:8.10
WORKDIR /app
COPY --from=build /project/target/*-runner /app/application
EXPOSE 8080
USER 1001
ENTRYPOINT ["./application"]
